!function(e,t){function r(e,t){return"all"!==t?u[t]:"where_from"===e||"dmca_requests"===e?"JUL 2012 - JUN 2016":"JUL 2013 - JUN 2016"}var a=e.select("body").append("div").attr("class","graph_tooltip").style("display","none"),n={Argentina:"ar",Afghanistan:"af",Bangladesh:"bd",Austria:"at",Australia:"au",Belgium:"be",Bulgaria:"bg",Chile:"cl",Denmark:"dk","Hong Kong":"hk",Ireland:"ie",Israel:"il",Iran:"ir",Italy:"it","South Korea":"kr",Korea:"kr",Luxembourg:"lu",Latvia:"lv",Mexico:"mx",Malaysia:"my",Netherlands:"nl",Norway:"no",Peru:"pe",Poland:"pl","Puerto Rico":"pr",Russia:"ru","Saudi Arabia":"sa",Serbia:"rs",Slovenia:"si",Slovakia:"sk",Senegal:"sn",USA:"us",France:"fr","United Kingdom":"gb",Spain:"es",India:"in","Sri Lanka":"lk",Germany:"de",Canada:"ca",Nepal:"np",Pakistan:"pk",Brazil:"br",China:"cn",Switzerland:"ch",Singapore:"sg","New Zealand":"nz",Japan:"jp","Czech Republic":"cz",Sweden:"se",Turkey:"tr",Greece:"gr",Cyprus:"cy",Ukraine:"ua",Taiwan:"tw",Suriname:"sr",Romania:"ro",Indonesia:"id",Liechtenstein:"li",Philippines:"ph","South Africa":"za",Tanzania:"tz",Portugal:"pt",Hungary:"hu",Venezuela:"ve",Croatia:"hr",Ecuador:"ec",Egypt:"eg",Estonia:"ee",Finland:"fi",Georgia:"ge",Malta:"mt",Morocco:"ma","Dominican Republic":"do",Guatemala:"gt",Uruguay:"uy"},u={juldec16:"Jul - Dec 2016",janjun16:"Jan - Jun 2016",juldec15:"Jul - Dec 2015",janjun15:"Jan - Jun 2015",juldec14:"Jul - Dec 2014",janjun14:"Jan - Jun 2014",juldec13:"Jul - Dec 2013",jul12jun13:"Jul 2012 - Jun 2013"};window.requestsAndGranted=function(u,s,i){function l(e,t){if("all"===t){var r={},a=[];return e.forEach(function(e){r[e.key]?(r[e.key].requests+=Number(e.requests),r[e.key].complied+=Number(e.complied)):(r[e.key]={},r[e.key].requests=Number(e.requests),r[e.key].complied=Number(e.complied))}),Object.keys(r).forEach(function(e){var t={key:e,requests:r[e].requests,complied:r[e].complied};a.push(t)}),a}return e.filter(function(e){return e.duration===t})}function o(r,u){function s(e,t){return q.filter(function(r){return r.key===e&&r.disclosed===t})[0]}var r=l(r,u);r.sort(function(e,t){var r=e.key.toLowerCase(),a=t.key.toLowerCase();return e.requests!==t.requests?t.requests-e.requests:a>r?-1:r>a?1:void 0});var i=r.map(function(e){return e.key}),o=i.indexOf("Unknown");if(o>-1){var c=r.splice(o,1);r.push(c[0])}var d=40*r.length+40;f.height(d),h.attr("height",d);for(var p=[],y=0;y<r.length;y++)p.push(y);var m=e.scale.ordinal().domain(r.map(function(e){return e.key})).range(p),k=e.scale.linear().domain([0,e.max(r,function(e){return Number(e.requests)})]).range([20,g]),x=(v.append("line").attr("class","left-line").attr("x1",0).attr("x2",0).attr("y1",20).attr("y2",d),v.selectAll("text.blue_bars").data(r,function(e){return e.key.split("*")[0]}));x.enter().append("text").attr("x","-100").style("opacity","0").attr("class","blue_bars"),x.text(function(e){var r="#t_";return r+=e.key.replace(/\W+/g," ").split(" ").join("_").toLowerCase(),0===t(r).size()&&console.log(r),t(r).val()}).on("mouseover",function(r){var n=Number(s(r.key,!0).value),u=Number(s(r.key,!1).value),i=t(e.event.target).offset().top+20,l=b+k(N[r.key])+50,o="<b>"+t("#t_total_requests").val()+"</b><span>"+(n+u)+"</span><b>"+t("#t_request_granted").val()+"</b><span>"+n+"</span>";return a.html(o).style("top",i+"px").style("left",l+"px").style("display","block")}).on("mouseout",function(){return a.style("display","none")}).on("click",function(e){""!==e.url&&"undefined"!=typeof e.url&&window.open("//"+e.url)}).classed("targeted",function(e){return""!==e.url&&"undefined"!=typeof e.url}).transition().style("opacity","1").attr("y",function(e,t){return 40*(t+1)}).attr("dy",-3).attr("x",5),x.exit().remove();var _=v.selectAll("image.flags").data(r,function(e){return e.key.split("*")[0]});_.enter().append("image").attr("class","flags").classed("flag",!0).each(function(e,t){"undefined"!=typeof n[e.key.split("*")[0]]&&v.append("rect").attr({"class":"flagBorder",width:"24",height:"18",y:function(){return 40*(t+1)-8},x:"-33"})}),_.attr("width",24).attr("height",18).attr("xlink:href",function(e){return"undefined"!=typeof n[e.key.split("*")[0]]?"./images/flags_svg/"+n[e.key.split("*")[0]]+".svg":void 0}).on("mouseover",function(r){var n=Number(s(r.key,!0).value),u=Number(s(r.key,!1).value),i=t(e.event.target).offset().top+11,l=b+k(N[r.key])+50,o="<b>"+t("#t_total_requests").val()+"</b><span>"+(n+u)+"</span><b>"+t("#t_request_granted").val()+"</b><span>"+n+"</span>";return a.html(o).style("top",i+"px").style("left",l+"px").style("display","block")}).on("mouseout",function(){return a.style("display","none")}).transition().attr("y",function(e,t){return 40*(t+1)-8}).attr("x",-33),_.exit().remove();var q=[],N=[];r.forEach(function(e){N[e.key]=Number(e.requests),q.push({key:e.key,disclosed:!0,value:+e.complied,x:Number(e.requests)-Number(e.complied)}),q.push({key:e.key,disclosed:!1,value:Number(e.requests)-Number(e.complied),x:0})});var w=v.selectAll("rect.blue_bars").data(q,function(e){return e.key+e.disclosed});w.enter().append("rect").attr("class","blue_bars"),w.on("mouseover",function(r){var n=Number(s(r.key,!0).value),u=Number(s(r.key,!1).value),i=t(e.event.target).offset().top,l=b+k(N[r.key])+50,o="<b>"+t("#t_total_requests").val()+"</b><span>"+(n+u)+"</span><b>"+t("#t_request_granted").val()+"</b><span>"+n+"</span>";return a.html(o).style("top",i+"px").style("left",l+"px").style("display","block")}).on("mouseout",function(){return a.style("display","none")}).attr("height","12").attr("y",function(e){return 40*(m(e.key)+1)+3}).classed("disclosed",function(e){return e.disclosed}).transition().attr("x",function(e){return k(e.x)-20}).attr("width",function(e){return 0===e.value?0:k(e.value)}),w.exit().remove()}function c(e,t){var a=l(e,t),n=a.reduce(function(e,t){return e+Number(t.requests)},0),u=a.reduce(function(e,t){return e+Number(t.complied)},0),i=f.parent().siblings(".col-md-4");i.find(".scorecard--1 dd").text(n),i.find(".scorecard--2 dd").text(u),i.find(".scorecard--1 h2").text(r(s,t)),i.find(".scorecard--2 h2").text(r(s,t))}function d(){t(".flagBorder").remove();var r=[].slice.call(document.querySelectorAll("#"+s+"_graph .flags"));r.forEach(function(t){t.getAttribute("href")&&e.select("#"+s+"_graph svg g").append("rect").attr({"class":"flagBorder",width:"24",height:"18",y:function(){return t.getAttribute("y")},x:function(){return t.getAttribute("x")}})})}var p=i,f=t("#"+s+"_graph"),y={top:10,right:10,bottom:10,left:40},g=f.width()-y.left-y.right,m=f.height()-y.top-y.bottom,h=e.select("#"+s+"_graph").append("svg").attr("width",g+y.left+y.right).attr("height",m+y.top+y.bottom),v=h.append("g").attr("transform","translate("+y.left+","+y.top+")"),b=t(h[0]).offset().left;o(u,p),c(u,p),t("."+s+"_tabs").click(function(){t("."+s+"_tabs").removeClass("active"),t(this).addClass("active");var e=t(this).attr("id").split("_")[2];o(u,e),c(u,e),setTimeout(d,350)})}}(d3,jQuery);